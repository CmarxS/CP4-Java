# Esportes API — CRUD de Brinquedos (Spring Boot + Oracle)

> Projeto de revisão com **Spring Boot**, **JPA**, **Oracle**, **Lombok** e **HATEOAS**. Endpoints testados via Postman/Insomnia e documentação prática neste README.

## Sumário
- [Descrição](#descrição)
- [Stack e versões](#stack-e-versões)
- [Dependências](#dependências)
- [Estrutura do projeto](#estrutura-do-projeto)
- [Configuração (application.properties)](#configuração-applicationproperties)
- [Banco de dados (DDL Oracle)](#banco-de-dados-ddl-oracle)
- [Entidade (Model)](#entidade-model)
- [Endpoints (CRUD)](#endpoints-crud)
- [Exemplos de requisições (cURL/Postman)](#exemplos-de-requisições-curlpostman)
- [HATEOAS (links)](#hateoas-links)
- [Erros comuns e soluções](#erros-comuns-e-soluções)
- [Deploy (opcional)](#deploy-opcional)
- [Integrantes e entrega](#integrantes-e-entrega)
- [Prints e evidências](#prints-e-evidências)

---

## Descrição
API para **empresa de brinquedos esportivos** (crianças até 12 anos), com **CRUD completo** sobre a entidade `Brinquedo`. Testes feitos por HTTP (Postman/Insomnia). Banco de dados alvo: **Oracle**.

**Campos obrigatórios:** `id`, `nome`, `tipo`, `classificacao`, `tamanho`, `preco`.

Base URL local: `https://cp4-java-g7er.onrender.com`.

---

## Stack e versões
- **Java**: 21  
- **Spring Boot**: 3.5.4  
- **Banco**: Oracle
- **Build**: Maven

---

## Dependências
- `spring-boot-starter-web`  
- `spring-boot-starter-data-jpa`  
- `spring-boot-starter-hateoas`  
- `spring-boot-starter-validation`  
- `lombok`  
- `ojdbc11` (Oracle JDBC)  
- `spring-boot-devtools` (dev)

> Observação: Swagger foi removido para evitar conflito com HATEOAS/HAL em Boot 3.5.x.

---

## Estrutura do projeto
```
src/main/java/br/com/fiap/esportes
 ├─ controller/          # BrinquedoController
 ├─ model/               # Brinquedo (Entity)
 ├─ repository/          # BrinquedoRepository (JpaRepository)
 ├─ service/             # (opcional neste exercício)
 └─ EsportesApplication  # classe principal

src/main/resources
 └─ application.properties
```

---

## Configuração (application.properties)

```properties
# Porta do servidor
server.port=8081

# Datasource Oracle (exemplo com SID ORCL)
spring.datasource.url=jdbc:oracle:thin:@oracle.fiap.com.br:1521:orcl
spring.datasource.username=SEU_USUARIO
spring.datasource.password=SUA_SENHA
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# Pool Hikari
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false
spring.jpa.database-platform=org.hibernate.dialect.OracleDialect

# Logs úteis
logging.level.org.hibernate.SQL=debug
logging.level.org.hibernate.orm.jdbc.bind=trace
```

> **Atenção ao `context-path`:** se usar `server.servlet.context-path=/brinquedos`, **não** mapeie o controller com `@RequestMapping("/brinquedos")`, para evitar rota duplicada (`/brinquedos/brinquedos`). Prefira manter **sem** `context-path` e usar `@RequestMapping("/brinquedos")` no controller.

---

## Banco de dados (DDL Oracle)
Crie a tabela `TDS_TB_BRINQUEDO`:

```sql
CREATE TABLE TDS_TB_BRINQUEDO (
  ID            NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NOME          VARCHAR2(100)   NOT NULL,
  TIPO          VARCHAR2(50)    NOT NULL,
  CLASSIFICACAO VARCHAR2(50)    NOT NULL,
  TAMANHO       VARCHAR2(50)    NOT NULL,
  PRECO         NUMBER(10,2)    NOT NULL
);
```

---

## Entidade (Model)
`Brinquedo` mapeado para `TDS_TB_BRINQUEDO` com Lombok para reduzir boilerplate e `RepresentationModel` para HATEOAS.

Campos principais:
- `Long id`
- `String nome`
- `String tipo`
- `String classificacao`
- `String tamanho`
- `Float preco`

---

## Endpoints (CRUD)
**Base path recomendado:** `/brinquedos`

- **GET** `/brinquedos` — lista todos
- **GET** `/brinquedos/{id}` — detalhe por id
- **POST** `/brinquedos` — cria novo
- **PUT** `/brinquedos/{id}` — atualiza todos os campos
- **DELETE** `/brinquedos/{id}` — exclui por id

Payload JSON (POST/PUT):
```json
{
  "nome": "Bola de Futebol Infantil",
  "tipo": "Bola",
  "classificacao": "5-8 anos",
  "tamanho": "3",
  "preco": 79.90
}
```

Respostas esperadas:
- `201 Created` (POST) com objeto salvo
- `200 OK` (GET/PUT)  
- `204 No Content` (DELETE)
- `404 Not Found` quando id não existir

---

## Exemplos de requisições (cURL/Postman)
**Criar**
```bash
curl -X POST http://localhost:8081/brinquedos   -H "Content-Type: application/json"   -d '{
    "nome": "Raquete de Tênis Kids",
    "tipo": "Raquete",
    "classificacao": "8-12 anos",
    "tamanho": "Junior",
    "preco": 199.90
  }'
```

**Listar**
```bash
curl http://localhost:8081/brinquedos
```

**Buscar por id**
```bash
curl http://localhost:8081/brinquedos/1
```

**Atualizar**
```bash
curl -X PUT http://localhost:8081/brinquedos/1   -H "Content-Type: application/json"   -d '{
    "nome": "Raquete de Tênis Kids Pro",
    "tipo": "Raquete",
    "classificacao": "8-12 anos",
    "tamanho": "Junior",
    "preco": 219.90
  }'
```

**Excluir**
```bash
curl -X DELETE http://localhost:8081/brinquedos/1
```

---

## HATEOAS (links)
Respostas podem incluir links com `_links` (self, update, delete). Exemplo (GET por id):
```json
{
  "id": 1,
  "nome": "Bola de Futebol Infantil",
  "tipo": "Bola",
  "classificacao": "5-8 anos",
  "tamanho": "3",
  "preco": 79.9,
  "_links": {
    "self": { "href": "http://localhost:8081/brinquedos/1" },
    "update": { "href": "http://localhost:8081/brinquedos/1" },
    "delete": { "href": "http://localhost:8081/brinquedos/1" }
  }
}
```

---

## Erros comuns e soluções
- **Swagger + HATEOAS (HAL) em Boot 3.5.x**: pode falhar no startup. Solução simples: remover Swagger ou usar SpringDoc 2.6.0 **sem** HAL.
- **Context-path duplicado**: `server.servlet.context-path=/brinquedos` **+** `@RequestMapping("/brinquedos")` gera rotas `/brinquedos/brinquedos`. Remova o context-path ou ajuste o mapping do controller.
- **Lombok não gera setter do `id`**: em dev, adicionar setter manual ou atualizar o objeto buscado do BD antes de salvar (abordagem recomendada em produção).
- **IDENTITY no Oracle**: se a sua versão não suportar, use sequence/trigger.

---

## Deploy (opcional)
1. Gerar JAR: `mvn clean package -DskipTests`
2. Definir variáveis de ambiente em produção: `SPRING_DATASOURCE_URL`, `SPRING_DATASOURCE_USERNAME`, `SPRING_DATASOURCE_PASSWORD`
3. Executar: `java -jar target/esportes-0.0.1-SNAPSHOT.jar`

> Plataformas possíveis: Render, Railway, Azure App Service, etc. Verificar conectividade com Oracle.

---

## Integrantes e entrega
```
RM555997 - Caio Marques
RM558640 - Caio Amarante
RM556325 - Felipe Camargo Revolta e Souza

IDE utilizada: IntelliJ
```
---

## Prints e evidências
Adicione no repositório (ex.: `docs/prints/`):
- **Spring Initializr** (config final e dependências)
- Testes no **Postman/Insomnia** (GET/POST/PUT/DELETE)
- Saída do console com SQL do Hibernate (opcional)

---

### Como rodar localmente (resumo)
1. Configure o `application.properties` (URL, usuário e senha Oracle).  
2. Garanta a tabela criada no Oracle (DDL acima).  
3. Rode: `mvn spring-boot:run` ou pelo IDE.  
4. Teste: `GET http://localhost:8081/brinquedos`.
